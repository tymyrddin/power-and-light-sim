#!/usr/bin/env python3
"""SMB null session â€” prove anonymous access to target.

Usage: python smb_null_session.py <host> <port>

Connects with null credentials (no username, no password).
If successful, lists available shares and exits.

Standard pentesting tool. Works against any SMB target.
"""

import sys

from impacket.smbconnection import SMBConnection


def main():
    if len(sys.argv) != 3:
        print(f"Usage: {sys.argv[0]} <host> <port>")
        sys.exit(1)

    host = sys.argv[1]
    port = int(sys.argv[2])

    conn = SMBConnection(host, host, sess_port=port)
    conn.login("", "")

    print(f"[+] Null session on {host}:{port}")
    print("[+] Shares:")
    for share in conn.listShares():
        name = share["shi1_netname"][:-1]
        print(f"    {name}")

    print(f"\n[*] Use smbclient to browse:")
    print(f"    smbclient //\"{host}\"/C$ -p {port} -N")

    conn.close()


if __name__ == "__main__":
    main()